## Upstream: https://github.com/simulationcraft/simc/blob/thewarwithin/ActionPriorityLists/default/mage_fire.simc
## SimulationCraft Commit Sync: 06cfdce
## Date: 2025-08-05

actions.precombat=arcane_intellect
actions.precombat+=/variable,name=cast_remains_time,value=0.2
actions.precombat+=/variable,name=pooling_time,value=15*gcd.max
actions.precombat+=/variable,name=ff_combustion_flamestrike,if=talent.frostfire_bolt,value=100
actions.precombat+=/variable,name=ff_filler_flamestrike,if=talent.frostfire_bolt,value=100
actions.precombat+=/variable,name=sf_combustion_flamestrike,if=talent.spellfire_spheres,value=100-(50*talent.mark_of_the_firelord)-(44*talent.quickflame)
actions.precombat+=/variable,name=sf_filler_flamestrike,if=talent.spellfire_spheres,value=100
actions.precombat+=/variable,name=treacherous_transmitter_precombat_cast,value=12,if=equipped.treacherous_transmitter
actions.precombat+=/use_item,name=treacherous_transmitter
# Whether a usable item used to buff Combustion is equipped.
actions.precombat+=/variable,name=combustion_on_use,value=equipped.gladiators_badge|equipped.treacherous_transmitter|equipped.moonlit_prism|equipped.irideus_fragment|equipped.spoils_of_neltharus|equipped.timebreaching_talon|equipped.horn_of_valor
# How long before Combustion should trinkets that trigger a shared category cooldown on other trinkets not be used?
actions.precombat+=/variable,name=on_use_cutoff,value=20,if=variable.combustion_on_use
actions.precombat+=/mirror_image
actions.precombat+=/frostfire_bolt,if=talent.frostfire_bolt
actions.precombat+=/combustion,if=!talent.firestarter
actions.precombat+=/pyroblast

# Executed every time the actor is available.
actions+=/counter_spell
actions+=/call_action_list,name=cds,if=!(buff.hot_streak.up&prev_gcd.1.scorch)
actions+=/run_action_list,name=ff_combustion,if=talent.frostfire_bolt&!buff.hyperthermia.up&(cooldown.combustion.remains<=variable.combustion_precast_time|buff.combustion.up)
actions+=/run_action_list,name=sf_combustion,if=!buff.hyperthermia.up&!(buff.hyperthermia.up&buff.lesser_time_warp.up)&(cooldown.combustion.remains<=variable.combustion_precast_time|buff.combustion.up)
actions+=/run_action_list,name=ff_filler,if=talent.frostfire_bolt
actions+=/run_action_list,name=sf_filler

actions.cds+=/variable,name=combustion_precast_time,value=talent.frostfire_bolt*(action.fireball.cast_time*(!improved_scorch.active|(action.scorch.cast_time<gcd.max))+action.scorch.cast_time*((action.scorch.cast_time>=gcd.max)&improved_scorch.active))+talent.spellfire_spheres*(action.fireball.cast_time*((action.scorch.cast_time<gcd.max)&buff.hot_streak.up|!talent.scorch)+action.scorch.cast_time*((action.scorch.cast_time>=gcd.max)|!buff.hot_streak.up))-variable.cast_remains_time
actions.cds+=/potion,if=time=0|buff.combustion.remains>6|boss&fight_remains<35
actions.cds+=/use_item,name=arazs_ritual_forge,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=neural_synapse_enhancer,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,effect_name=gladiators_badge,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=signet_of_the_priory,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=sunblood_amethyst,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=lily_of_the_eternal_weave,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=funhouse_lens,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=mereldars_toll,if=buff.combustion.remains>6|boss&fight_remains<15
actions.cds+=/use_item,name=flarendos_pilot_light,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=house_of_cards,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=soulletting_ruby,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=quickwick_candlestick,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/use_item,name=hyperthread_wristwraps,if=hyperthread_wristwraps.fire_blast>=2&buff.combustion.remains&action.fire_blast.charges=0
actions.cds+=/use_items
actions.cds+=/ancestral_call,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/berserking,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/blood_fury,if=buff.combustion.remains>6|boss&fight_remains<20
actions.cds+=/fireblood,if=buff.combustion.remains>6|boss&fight_remains<10
## actions.cds+=/invoke_external_buff,name=power_infusion,if=buff.power_infusion.down&(buff.combustion.remains>6|fight_remains<25)
## actions.cds+=/invoke_external_buff,name=blessing_of_summer,if=buff.blessing_of_summer.down

actions.ff_combustion+=/combustion,use_off_gcd=1,use_while_casting=1,if=buff.combustion.down&action.fireball.executing&(action.fireball.execute_remains<variable.cast_remains_time)|action.meteor.in_flight&(action.meteor.in_flight_remains<variable.cast_remains_time)|action.pyroblast.executing&(action.pyroblast.execute_remains<variable.cast_remains_time)|action.scorch.executing&(action.scorch.execute_remains<variable.cast_remains_time)
actions.ff_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&!action.scorch.executing&!action.fireball.executing&!action.pyroblast.executing&!buff.hot_streak.up&gcd.remains&gcd.remains<gcd.max&(hot_streak_spells_in_flight+buff.heating_up.up)<2&!buff.fury_of_the_sun_king.up
actions.ff_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&buff.heating_up.up&action.pyroblast.executing&action.pyroblast.execute_remains<0.5
actions.ff_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&buff.heating_up.up&action.fireball.executing&action.fireball.execute_remains<0.5
actions.ff_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&!buff.heating_up.up&!buff.hot_streak.up&action.scorch.executing&action.scorch.execute_remains<0.5
actions.ff_combustion+=/flamestrike,if=buff.fury_of_the_sun_king.up&active_enemies>=variable.ff_combustion_flamestrike
actions.ff_combustion+=/pyroblast,if=buff.fury_of_the_sun_king.up
actions.ff_combustion+=/meteor,if=buff.combustion.down|buff.combustion.remains>2
actions.ff_combustion+=/scorch,if=buff.combustion.down&!prev_gcd.1.scorch&cast_time>=gcd.max&(buff.heat_shimmer.up&talent.improved_scorch|improved_scorch.active)
actions.ff_combustion+=/fireball,if=buff.combustion.down
actions.ff_combustion+=/flamestrike,if=buff.hot_streak.up&active_enemies>=variable.ff_combustion_flamestrike
actions.ff_combustion+=/flamestrike,if=prev_gcd.1.scorch&buff.heating_up.up&active_enemies>=variable.ff_combustion_flamestrike
actions.ff_combustion+=/pyroblast,if=buff.hot_streak.up
actions.ff_combustion+=/pyroblast,if=prev_gcd.1.scorch&buff.heating_up.up
actions.ff_combustion+=/phoenix_flames,if=buff.excess_frost.up&(!action.pyroblast.in_flight|!buff.heating_up.up)
actions.ff_combustion+=/fireball

actions.ff_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.heating_up.up&action.fireball.executing&action.fireball.execute_remains<0.5&((cooldown.combustion.remains>variable.pooling_time)|talent.sun_kings_blessing)
actions.ff_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.heating_up.up&action.pyroblast.executing&action.pyroblast.execute_remains<0.5
actions.ff_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=!buff.hot_streak.up&!buff.heating_up.up&action.scorch.executing&action.scorch.execute_remains<0.5&((cooldown.combustion.remains>variable.pooling_time)|talent.sun_kings_blessing)
actions.ff_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=!buff.hot_streak.up&action.shifting_power.executing&((cooldown.combustion.remains>variable.pooling_time)|talent.sun_kings_blessing)
actions.ff_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=!buff.hot_streak.up&(hot_streak_spells_in_flight+buff.heating_up.up<2)&buff.hyperthermia.up&gcd.remains<gcd.max&((cooldown.combustion.remains>variable.pooling_time)|talent.sun_kings_blessing)
actions.ff_filler+=/meteor,if=((cooldown.combustion.remains>variable.pooling_time)|talent.sun_kings_blessing)
actions.ff_filler+=/scorch,if=(improved_scorch.active|buff.heat_shimmer.up&talent.improved_scorch)&debuff.improved_scorch.remains<3*gcd.max&!prev_gcd.1.scorch
actions.ff_filler+=/flamestrike,if=buff.fury_of_the_sun_king.up&active_enemies>=variable.ff_filler_flamestrike
actions.ff_filler+=/flamestrike,if=buff.hyperthermia.up&active_enemies>=variable.ff_filler_flamestrike
actions.ff_filler+=/flamestrike,if=prev_gcd.1.scorch&buff.heating_up.up&active_enemies>=variable.ff_filler_flamestrike
actions.ff_filler+=/flamestrike,if=buff.hot_streak.up&active_enemies>=variable.ff_filler_flamestrike
actions.ff_filler+=/pyroblast,if=buff.fury_of_the_sun_king.up
actions.ff_filler+=/pyroblast,if=buff.hyperthermia.up
actions.ff_filler+=/pyroblast,if=prev_gcd.1.scorch&buff.heating_up.up
actions.ff_filler+=/pyroblast,if=buff.hot_streak.up
actions.ff_filler+=/shifting_power,if=cooldown.combustion.remains>10
actions.ff_filler+=/fireball,if=talent.sun_kings_blessing&buff.frostfire_empowerment.up
actions.ff_filler+=/phoenix_flames,if=(buff.excess_frost.up|talent.sun_kings_blessing)&!(action.frostfire_bolt.time_since<0.5)
actions.ff_filler+=/scorch,if=talent.sun_kings_blessing&(scorch_execute.active|buff.heat_shimmer.up)
actions.ff_filler+=/fireball

actions.sf_combustion+=/combustion,use_off_gcd=1,use_while_casting=1,if=action.fireball.executing&(action.fireball.execute_remains<variable.cast_remains_time)|action.scorch.executing&(action.scorch.execute_remains<variable.cast_remains_time)
actions.sf_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&!action.scorch.executing&!action.fireball.executing&!action.pyroblast.executing&!buff.hot_streak.up&gcd.remains&gcd.remains<gcd.max&(!talent.glorious_incandescence|buff.glorious_incandescence.up|charges_fractional>1.7|buff.combustion.remains<(gcd.max*charges))&(hot_streak_spells_in_flight+buff.heating_up.up)<2
actions.sf_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&buff.heating_up.up&action.pyroblast.executing&action.pyroblast.execute_remains<0.5
actions.sf_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&buff.heating_up.up&action.fireball.executing&action.fireball.execute_remains<0.5
actions.sf_combustion+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.combustion.up&!buff.heating_up.up&!buff.hot_streak.up&action.scorch.executing&action.scorch.execute_remains<0.5
actions.sf_combustion+=/scorch,if=buff.combustion.down&(cast_time>=gcd.max|!buff.hot_streak.up)
actions.sf_combustion+=/fireball,if=buff.combustion.down
actions.sf_combustion+=/flamestrike,if=buff.hot_streak.up&active_enemies>=variable.sf_combustion_flamestrike
actions.sf_combustion+=/flamestrike,if=prev_gcd.1.scorch&buff.heating_up.up&active_enemies>=variable.sf_combustion_flamestrike
actions.sf_combustion+=/pyroblast,if=buff.hot_streak.up
actions.sf_combustion+=/pyroblast,if=prev_gcd.1.scorch&buff.heating_up.up
actions.sf_combustion+=/scorch,if=(improved_scorch.active|buff.heat_shimmer.up)&debuff.improved_scorch.remains<4*gcd.max
actions.sf_combustion+=/phoenix_flames
actions.sf_combustion+=/scorch
actions.sf_combustion+=/fireball

actions.sf_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=buff.heating_up.up&action.fireball.executing&action.fireball.execute_remains<0.5
actions.sf_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=!buff.hot_streak.up&!buff.heating_up.up&action.scorch.executing&action.scorch.execute_remains<0.5&cooldown.combustion.remains>variable.pooling_time
actions.sf_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=!buff.hot_streak.up&action.shifting_power.executing&cooldown.combustion.remains>variable.pooling_time
actions.sf_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=!buff.hot_streak.up&(hot_streak_spells_in_flight+buff.heating_up.up<2)&(buff.hyperthermia.up|buff.hyperthermia.up&buff.lesser_time_warp.up)&gcd.remains<gcd.max&(!talent.glorious_incandescence|buff.glorious_incandescence.up|charges_fractional>1.7|buff.hyperthermia.remains<(gcd.max*charges))&cooldown.combustion.remains>variable.pooling_time
actions.sf_filler+=/fire_blast,use_off_gcd=1,use_while_casting=1,if=active_enemies>=2&!buff.hot_streak.up&(hot_streak_spells_in_flight+buff.heating_up.up<2)&buff.glorious_incandescence.up&cooldown.combustion.remains>variable.pooling_time
actions.sf_filler+=/flamestrike,if=(buff.hyperthermia.up|buff.hyperthermia.up&buff.lesser_time_warp.up)&active_enemies>=variable.sf_filler_flamestrike
actions.sf_filler+=/flamestrike,if=buff.hot_streak.up&active_enemies>=variable.sf_filler_flamestrike
actions.sf_filler+=/flamestrike,if=prev_gcd.1.scorch&buff.heating_up.up&active_enemies>=variable.sf_filler_flamestrike
actions.sf_filler+=/pyroblast,if=buff.hyperthermia.up|buff.hyperthermia.up&buff.lesser_time_warp.up
actions.sf_filler+=/pyroblast,if=buff.hot_streak.up
actions.sf_filler+=/pyroblast,if=prev_gcd.1.scorch&buff.heating_up.up
actions.sf_filler+=/shifting_power
actions.sf_filler+=/scorch,if=buff.heat_shimmer.up
actions.sf_filler+=/meteor,if=active_enemies>=2
actions.sf_filler+=/phoenix_flames,if=buff.heating_up.up|action.fire_blast.ready|action.phoenix_flames.charges_fractional>1.5|buff.born_of_flame.up
actions.sf_filler+=/scorch,if=scorch_execute.active
actions.sf_filler+=/fireball