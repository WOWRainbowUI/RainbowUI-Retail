## Upstream: https://github.com/simulationcraft/simc/blob/thewarwithin/ActionPriorityLists/default/mage_frost.simc
## SimulationCraft Commit Sync: e8d92c5
## Date: 2025-08-12

actions.precombat+=/arcane_intellect
actions.precombat+=/mirror_image
actions.precombat+=/variable,name=treacherous_transmitter_precombat_cast,value=12,if=equipped.treacherous_transmitter
actions.precombat+=/use_item,name=treacherous_transmitter
actions.precombat+=/use_item,name=ingenious_mana_battery
actions.precombat+=/blizzard,if=active_enemies>=3
actions.precombat+=/frostbolt,if=active_enemies<=2

actions+=/counterspell
actions+=/call_action_list,name=cds
actions+=/run_action_list,name=ff_aoe,strict=1,if=talent.frostfire_bolt&active_enemies>=3
actions+=/run_action_list,name=ss_aoe,strict=1,if=!talent.frostfire_bolt&active_enemies>=3
actions+=/run_action_list,name=ff_cleave,strict=1,if=talent.frostfire_bolt&active_enemies=2
actions+=/run_action_list,name=ss_cleave,strict=1,if=!talent.frostfire_bolt&active_enemies=2
actions+=/run_action_list,name=ff_st_boltspam,if=talent.frostfire_bolt&(talent.glacial_spike&talent.slick_ice&talent.cold_front&talent.deaths_chill&talent.deep_shatter)
actions+=/run_action_list,name=ff_st,strict=1,if=talent.frostfire_bolt
actions+=/run_action_list,name=ss_st,strict=1,if=!talent.frostfire_bolt

# Spellslinger uses Icy Veins after the initial Flurry in the ST/Cleave opener to guarantee being in combat for Augury Abounds.
actions.cds+=/flurry,if=time<0.2&active_enemies<=2&talent.splinterstorm
actions.cds+=/icy_veins
# Potion
actions.cds+=/potion,if=buff.icy_veins.remains>15|boss&fight_remains<35
actions.cds+=/use_item,name=treacherous_transmitter,if=fight_remains<32+20*equipped.spymasters_web|prev_off_gcd.icy_veins|(cooldown.icy_veins.remains<12|cooldown.icy_veins.remains<22&cooldown.shifting_power.remains<10)
# actions.cds+=/do_treacherous_transmitter_task,if=fight_remains<18|(buff.cryptic_instructions.remains<?buff.realigning_nexus_convergence_divergence.remains<?buff.errant_manaforge_emission.remains)<(action.shifting_power.execute_time+talent.ray_of_frost.rank)
actions.cds+=/use_item,name=spymasters_web,if=fight_remains<20|buff.icy_veins.remains<19&(fight_remains<105|buff.spymasters_report.stack>=32)&(buff.icy_veins.remains>15|trinket.treacherous_transmitter.cooldown.remains>50)
actions.cds+=/use_item,name=arazs_ritual_forge
actions.cds+=/use_item,name=signet_of_the_priory
actions.cds+=/use_item,name=sunblood_amethyst,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=lily_of_the_eternal_weave,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=funhouse_lens,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=mereldars_toll,if=buff.icy_veins.remains>10|boss&fight_remains<15
actions.cds+=/use_item,name=house_of_cards,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=flarendos_pilot_light
actions.cds+=/use_item,name=soulletting_ruby
actions.cds+=/use_item,name=quickwick_candlestick,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=imperfect_ascendancy_serum,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=burst_of_knowledge,if=buff.icy_veins.remains>10|boss&fight_remains<20
actions.cds+=/use_item,name=ratfang_toxin,if=time>10
actions.cds+=/use_item,name=neural_synapse_enhancer,if=active_enemies<=2|prev_gcd.1.comet_storm|fight_remains<20
actions.cds+=/use_items
# Opener for AoE and Frostfire ST/Cleave
actions.cds+=/flurry,if=time<0.2&active_enemies<=2
actions.cds+=/frozen_orb,if=time<0.2&active_enemies>=3
# Racials
actions.cds+=/blood_fury
actions.cds+=/berserking,if=buff.icy_veins.remains>10|fight_remains<15
actions.cds+=/fireblood
actions.cds+=/ancestral_call
# Externals
## actions.cds+=/invoke_external_buff,name=power_infusion,if=buff.power_infusion.down
## actions.cds+=/invoke_external_buff,name=blessing_of_summer,if=buff.blessing_of_summer.down

actions.ff_aoe+=/cone_of_cold,if=talent.coldest_snap&prev_gcd.1.comet_storm
# Against freezable targets prioritize Pet Freeze and Ice Nova to shatter Glacial Spike and Comet Storm.
actions.ff_aoe+=/freeze,if=freezable&action.cone_of_cold.time_since>8&(prev_gcd.1.glacial_spike&remaining_winters_chill=0&debuff.winters_chill.down|prev_gcd.1.comet_storm)
actions.ff_aoe+=/ice_nova,if=!prev_off_gcd.freeze&freezable&action.cone_of_cold.time_since>8&(prev_gcd.1.glacial_spike&remaining_winters_chill=0&debuff.winters_chill.down|prev_gcd.1.comet_storm)
actions.ff_aoe+=/flurry,if=!prev_off_gcd.freeze&remaining_winters_chill=0&debuff.winters_chill.down&prev_gcd.1.glacial_spike
actions.ff_aoe+=/frozen_orb
actions.ff_aoe+=/ice_lance,if=buff.excess_fire.stack=2&cooldown.comet_storm.up
actions.ff_aoe+=/blizzard,if=talent.ice_caller|talent.freezing_rain
# During Icy Veins stack Death's Chill to 12 while keeping Blizzard and Frozen Orb on cooldown.
actions.ff_aoe+=/frostfire_bolt,if=talent.deaths_chill&buff.icy_veins.up&(buff.deaths_chill.stack<9|buff.deaths_chill.stack=9&!action.frostfire_bolt.in_flight)
# Don't munch Excess Fire before pressing the 2nd Comet Storm in the Cone of Cold sequence. Only relevant for Deaths Chill builds.
actions.ff_aoe+=/ice_lance,if=talent.deaths_chill&buff.excess_fire.stack=2&cooldown.comet_storm.ready
# Hold Comet Storm for up to 12 seconds for Cone of Cold.
actions.ff_aoe+=/comet_storm,if=cooldown.cone_of_cold.remains>12|cooldown.cone_of_cold.ready
actions.ff_aoe+=/ray_of_frost,if=talent.splintering_ray&remaining_winters_chill=2
actions.ff_aoe+=/glacial_spike,if=buff.icicles.stack=5
# Cast Flurry to spend Excess Frost.
actions.ff_aoe+=/flurry,if=buff.excess_frost.up
# With Araz's Ritual Forge equipped only cast Shifting Power outside of Icy Veins to create more overlap with subsequent Icy Veins.
actions.ff_aoe+=/shifting_power,if=(!equipped.arazs_ritual_forge|buff.icy_veins.down)&cooldown.icy_veins.remains>8&(cooldown.comet_storm.remains>8|!talent.comet_storm)&cooldown.blizzard.remains>6*gcd.max
actions.ff_aoe+=/frostfire_bolt,if=buff.frostfire_empowerment.up&!buff.excess_fire.up
actions.ff_aoe+=/ice_lance,if=buff.fingers_of_frost.up
actions.ff_aoe+=/ice_lance,if=remaining_winters_chill
actions.ff_aoe+=/frostfire_bolt
actions.ff_aoe+=/call_action_list,name=movement

# If one of your targets doesnt have Winter's Chill up, target-swap and queue a Flurry after casting Glacial Spike, Frostfire Bolt or Comet Storm.
actions.ff_cleave+=/flurry,cycle_targets=1,if=prev_gcd.1.glacial_spike|prev_gcd.1.frostfire_bolt|prev_gcd.1.comet_storm
actions.ff_cleave+=/comet_storm
actions.ff_cleave+=/glacial_spike,if=buff.icicles.stack=5
actions.ff_cleave+=/frozen_orb
actions.ff_cleave+=/blizzard,if=buff.icy_veins.down&buff.freezing_rain.up
# With Araz's Ritual Forge equipped only cast Shifting Power outside of Icy Veins to create more overlap with subsequent Icy Veins.
actions.ff_cleave+=/shifting_power,if=(!equipped.arazs_ritual_forge|buff.icy_veins.down)&cooldown.icy_veins.remains>8&(cooldown.comet_storm.remains>8|!talent.comet_storm)
actions.ff_cleave+=/ice_lance,if=buff.fingers_of_frost.up
# Without Death's Chill talented, also cast Ice Lance into any target with 2 stacks of Winter's Chill.
actions.ff_cleave+=/ice_lance,cycle_targets=1,if=!talent.deaths_chill&remaining_winters_chill=2
# Always cast Frostfire Bolt at the target with the lowest number of Winter's Chill stacks.
actions.ff_cleave+=/frostfire_bolt,cycle_targets=1
actions.ff_cleave+=/call_action_list,name=movement

actions.ff_st+=/flurry,if=remaining_winters_chill=0&debuff.winters_chill.down&prev_gcd.1.glacial_spike
# Cast Flurry with 3+ Icicles to guarantee shattering the Glacial Spike + Pyroblast into Winter's Chill. This also means queueing Flurry when casting Frostfire Bolt with 2+ Icicles and overcapping freely.
actions.ff_st+=/flurry,if=remaining_winters_chill=0&debuff.winters_chill.down&(buff.icicles.stack>=3|!talent.glacial_spike)
actions.ff_st+=/comet_storm,if=remaining_winters_chill
actions.ff_st+=/ray_of_frost,if=remaining_winters_chill=2
actions.ff_st+=/glacial_spike,if=buff.icicles.stack=5
actions.ff_st+=/frozen_orb
# With Araz's Ritual Forge equipped only cast Shifting Power outside of Icy Veins to create more overlap with subsequent Icy Veins.
actions.ff_st+=/shifting_power,if=(!equipped.arazs_ritual_forge|buff.icy_veins.down)&cooldown.icy_veins.remains>8&(cooldown.comet_storm.remains>8|!talent.comet_storm)
actions.ff_st+=/ice_lance,if=buff.fingers_of_frost.up
actions.ff_st+=/ice_lance,if=remaining_winters_chill
actions.ff_st+=/frostfire_bolt
actions.ff_st+=/call_action_list,name=movement

# The Boltspam roation is used whenever all of Death's Chill, Cold Front, Slick Ice and at least one point of Deep Shatter is talented.
actions.ff_st_boltspam+=/flurry,if=remaining_winters_chill=0&debuff.winters_chill.down&prev_gcd.1.glacial_spike
# Queue Flurry whenever casting Frostfire Bolt with 2+ Icicles.
actions.ff_st_boltspam+=/flurry,if=prev_gcd.1.frostfire_bolt&buff.icicles.stack>=3
actions.ff_st_boltspam+=/comet_storm,if=remaining_winters_chill
actions.ff_st_boltspam+=/glacial_spike,if=buff.icicles.stack=5
actions.ff_st_boltspam+=/shifting_power,if=buff.icy_veins.down&cooldown.comet_storm.remains>8&cooldown.icy_veins.remains>8
actions.ff_st_boltspam+=/ice_lance,if=remaining_winters_chill=2
actions.ff_st_boltspam+=/ice_lance,if=buff.fingers_of_frost.up&buff.icicles.down
actions.ff_st_boltspam+=/frostfire_bolt
actions.ff_st_boltspam+=/call_action_list,name=movement

actions.movement+=/ice_floes,if=buff.ice_floes.down
actions.movement+=/any_blink,if=movement.distance>5
actions.movement+=/flurry
actions.movement+=/frozen_orb
actions.movement+=/comet_storm,if=talent.splinterstorm
actions.movement+=/ice_nova
actions.movement+=/ice_lance

actions.ss_aoe+=/cone_of_cold,if=talent.coldest_snap&(prev_gcd.1.frozen_orb|cooldown.frozen_orb.remains>30)
# Cast Ice Nova against 5+ freezable targets to consume the Winter's Chill debuff applied by Cone of Cold in the very last moment of its duration.
actions.ss_aoe+=/ice_nova,if=(freezable|talent.unerring_proficiency)&active_enemies>=5&action.cone_of_cold.time_since<8&action.cone_of_cold.time_since>7
# Cast Pet Freeze whenever you cast Glacial Spike against freezable targets to shatter the second Glacial Spike.
actions.ss_aoe+=/freeze,if=freezable&(prev_gcd.1.glacial_spike|!talent.glacial_spike&action.cone_of_cold.time_since>8)
actions.ss_aoe+=/flurry,if=remaining_winters_chill=0&debuff.winters_chill.down&prev_gcd.1.glacial_spike
actions.ss_aoe+=/flurry,if=remaining_winters_chill=0&debuff.winters_chill.down&prev_gcd.1.frostbolt
# Cast Flurry regardless of Winter's Chill to spend the Cold Front buff.
actions.ss_aoe+=/flurry,if=buff.cold_front_ready.up
actions.ss_aoe+=/frozen_orb
actions.ss_aoe+=/blizzard,if=talent.ice_caller|talent.freezing_rain
actions.ss_aoe+=/comet_storm,if=talent.glacial_assault|buff.icy_veins.down
actions.ss_aoe+=/ray_of_frost,if=talent.splintering_ray&buff.icy_veins.down&remaining_winters_chill
actions.ss_aoe+=/shifting_power,if=talent.shifting_shards
# Not munching Fingers of Frost is more important than munching Icicles.
actions.ss_aoe+=/ice_lance,if=buff.fingers_of_frost.stack=2&talent.glacial_spike
# Cast Glacial Spike if you can shatter it into Winter's Chill or with a followup Flurry.
actions.ss_aoe+=/glacial_spike,if=buff.icicles.stack=5&(action.flurry.ready|remaining_winters_chill)
# During Icy Veins stack Deaths Chill to 9 before using regular Ice Lances.
actions.ss_aoe+=/frostbolt,if=talent.deaths_chill&buff.icy_veins.up&(buff.deaths_chill.stack<6|buff.deaths_chill.stack=6&!action.frostbolt.in_flight)
actions.ss_aoe+=/ice_lance,if=buff.fingers_of_frost.up
actions.ss_aoe+=/ice_lance,if=remaining_winters_chill
actions.ss_aoe+=/shifting_power,if=buff.icy_veins.down&cooldown.icy_veins.remains>8
actions.ss_aoe+=/frostbolt
actions.ss_aoe+=/call_action_list,name=movement

# Flurry the off-target after Glacial Spike to make it shatter on both targets.
actions.ss_cleave+=/flurry,cycle_targets=1,if=prev_gcd.1.glacial_spike
actions.ss_cleave+=/flurry,if=debuff.winters_chill.down&remaining_winters_chill=0&prev_gcd.1.frostbolt
# With Shifting Shards talented cast Flurry with or without precast to spend the Cold Front buff.
actions.ss_cleave+=/flurry,if=debuff.winters_chill.down&remaining_winters_chill=0&talent.shifting_shards&buff.cold_front_ready.up
# Not munching Fingers of Frost is more important than munching Icicles.
actions.ss_cleave+=/ice_lance,if=buff.fingers_of_frost.up=2&talent.glacial_spike
actions.ss_cleave+=/frozen_orb
actions.ss_cleave+=/comet_storm,if=buff.icy_veins.down&remaining_winters_chill&talent.shifting_shards
actions.ss_cleave+=/shifting_power,if=!equipped.arazs_ritual_forge&cooldown.flurry.charges<2&cooldown.icy_veins.remains>8|talent.shifting_shards
# Cast Glacial Spike if you can shatter it into Winter's Chill or with a followup Flurry.
actions.ss_cleave+=/glacial_spike,if=buff.icicles.stack=5&(action.flurry.ready|remaining_winters_chill)
actions.ss_cleave+=/blizzard,if=buff.freezing_rain.up&talent.ice_caller
actions.ss_cleave+=/ice_lance,if=buff.fingers_of_frost.up
# In Icy Veins only ever cast Ice Lance with Fingers of Frost until you have at least 10 Deaths Chill stacks.
actions.ss_cleave+=/frostbolt,if=talent.deaths_chill&buff.icy_veins.up&(buff.deaths_chill.stack<8|buff.deaths_chill.stack=8&!action.frostbolt.in_flight)
actions.ss_cleave+=/ice_lance,cycle_targets=1,if=remaining_winters_chill
actions.ss_cleave+=/shifting_power,if=equipped.arazs_ritual_forge&buff.icy_veins.down&cooldown.flurry.charges<2&cooldown.icy_veins.remains>8
actions.ss_cleave+=/frostbolt
actions.ss_cleave+=/call_action_list,name=movement

actions.ss_st+=/flurry,if=debuff.winters_chill.down&remaining_winters_chill=0&prev_gcd.1.glacial_spike
actions.ss_st+=/flurry,if=debuff.winters_chill.down&remaining_winters_chill=0&(buff.icicles.stack<5|!talent.glacial_spike)&prev_gcd.1.frostbolt
actions.ss_st+=/frozen_orb
actions.ss_st+=/comet_storm,if=buff.icy_veins.down&remaining_winters_chill&talent.shifting_shards
actions.ss_st+=/ray_of_frost,if=buff.icy_veins.down&remaining_winters_chill=1
actions.ss_st+=/shifting_power,if=!equipped.arazs_ritual_forge&cooldown.flurry.charges<2&cooldown.icy_veins.remains>8|talent.shifting_shards
# Cast Glacial Spike if you can shatter it into Winter's Chill or with a followup Flurry.
actions.ss_st+=/glacial_spike,if=buff.icicles.stack=5&(action.flurry.ready|remaining_winters_chill)
actions.ss_st+=/blizzard,if=buff.icy_veins.down&buff.freezing_rain.up&talent.ice_caller
actions.ss_st+=/ice_lance,if=buff.fingers_of_frost.up
actions.ss_st+=/ice_lance,if=remaining_winters_chill
actions.ss_st+=/shifting_power,if=equipped.arazs_ritual_forge&buff.icy_veins.down&cooldown.flurry.charges<2&cooldown.icy_veins.remains>8
actions.ss_st+=/frostbolt
actions.ss_st+=/call_action_list,name=movement